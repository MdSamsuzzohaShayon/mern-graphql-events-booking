(this["webpackJsonpevents-booking"]=this["webpackJsonpevents-booking"]||[]).push([[0],{217:function(e,t,n){},218:function(e,t,n){},336:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),a=n(63),c=n.n(a),r=(n(217),n(8)),s=n(9),l=n(14),d=n(13),u=(n(218),n(219),n(68)),j=n(15),h={LOCALHOST_API:"http://localhost:8000/graphql",HEROKU_API:"https://mern-graphql-events.herokuapp.com/graphql",API_ENDPOINT:"https://mern-graphql-events.herokuapp.com/graphql"},b=n(347),O=n(350),p=n(353),x=o.a.createContext({token:null,userId:null,login:function(e,t,n){},logout:function(){}}),g=n(2),f=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).switchModeHandler=function(){i.setState((function(e){return{isLogin:!e.isLogin}}))},i.submitHandler=function(e){e.preventDefault();var t=i.emailEl.current.value,n=i.passwordEl.current.value;if(0!==t.trim().length&&0!==n.trim().length){console.log(t,n);var o={query:"\n                query Login($email: String!, $password: String!){\n                    login(email: $email, password: $password){\n                        userId\n                        token\n                        tokenExpiration\n                    }\n                }\n            ",variables:{email:t,password:n}};i.state.isLogin||(o={query:"\n                mutation CreateUser($email: String!, $password: String!){\n                    createUser(userInput: {email: $email, password: $password}){\n                        _id\n                        email\n                    }\n                }\n            ",variables:{email:t,password:n}}),fetch(h.API_ENDPOINT,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){console.log(e),e.data.login.token&&i.context.login(e.data.login.token,e.data.login.userId,e.data.login.tokenExpiration)})).catch((function(e){console.log(e)}))}},i.state={isLogin:!0},i.emailEl=o.a.createRef(),i.passwordEl=o.a.createRef(),i}return Object(s.a)(n,[{key:"render",value:function(){return Object(g.jsxs)(b.a,{children:[Object(g.jsx)("br",{}),Object(g.jsx)("br",{}),Object(g.jsxs)(O.a,{onSubmit:this.submitHandler,children:[Object(g.jsxs)(O.a.Group,{widths:"equal",children:[Object(g.jsxs)(O.a.Field,{children:[Object(g.jsx)("label",{className:"ui header blue",children:"Email"}),Object(g.jsx)("input",{type:"email",ref:this.emailEl,placeholder:"Enter your email"})]}),Object(g.jsxs)(O.a.Field,{children:[Object(g.jsx)("label",{className:"ui header blue",children:"Password"}),Object(g.jsx)("input",{type:"password",ref:this.passwordEl,placeholder:"Enter your password"})]})]}),Object(g.jsxs)(p.a.Group,{children:[Object(g.jsx)(p.a,{color:"teal",type:"submit",children:"Submit"}),Object(g.jsx)(p.a.Or,{}),Object(g.jsxs)(p.a,{color:"teal",onClick:this.switchModeHandler,type:"button",children:["Switch to ",this.state.isLogin?"Signup":"Login"]})]})]})]})}}]),n}(i.Component);f.contextType=x;var m=f,v=n(22),k=n(164),E=n(356),y=n(354),S=n(349),C=n(98),I=n(351),w=n(202),T=n(348),A=n(352),P=function(e){var t=Object(i.useState)(!1),n=Object(C.a)(t,2),o=n[0],a=n[1],c=Object(i.useState)(null),r=Object(C.a)(c,2),s=r[0],l=r[1];var d=e.events.map((function(t){return console.log("Event ID: ",t._id),Object(g.jsx)(I.a.Item,{children:Object(g.jsxs)(k.a,{color:"teal",children:[Object(g.jsx)(E.a,{as:"h3",color:"teal",children:t.title}),Object(g.jsxs)(w.a,{columns:2,relaxed:"very",stackable:!0,children:[Object(g.jsx)(w.a.Column,{children:Object(g.jsxs)(E.a,{as:"h5",color:"red",children:["Ticket Price $ ",t.price]})}),Object(g.jsx)(w.a.Column,{verticalAlign:"middle",children:Object(g.jsxs)(E.a,{as:"h5",color:"teal",textAlign:"right",children:["Date ",new Date(t.date).toLocaleDateString()]})})]}),Object(g.jsx)(T.a,{vertical:!0,children:"And"}),e.authUserId===t.creator._id?Object(g.jsxs)("p",{children:[Object(g.jsx)("br",{}),"you are owner of this event"]}):Object(g.jsxs)(A.a,{onClose:function(){return a(!1)},onOpen:function(e){e.preventDefault(),a((function(e){return!0})),console.log("Open events ID: ",e.target.value),l(e.target.value)},open:o,trigger:Object(g.jsx)(p.a,{color:"teal",value:t._id,children:"View Details"}),children:[Object(g.jsx)(A.a.Header,{children:"Event Details"}),Object(g.jsx)(A.a.Content,{children:Object(g.jsxs)(A.a.Description,{children:[Object(g.jsx)(E.a,{children:t.title}),Object(g.jsxs)(E.a,{as:"h5",color:"red",children:["Price $ ",t.price]}),Object(g.jsx)("p",{children:t.description}),Object(g.jsx)(E.a,{as:"h3",color:"teal",children:new Date(t.date).toLocaleDateString()})]})}),Object(g.jsxs)(A.a.Actions,{children:[Object(g.jsx)(p.a,{color:"black",onClick:function(){return a(!1)},children:"Cancel"}),Object(g.jsx)(p.a,{content:e.context.token?"Book Event":"Confirm",labelPosition:"right",icon:"checkmark",onClick:function(t){return function(t){if(e.context.token){console.log("Token: ",e.context.token),a((function(e){return!1}));var n={query:"\n                mutation BookEvent($id: ID!){\n                    bookEvent (eventId: $id){\n                    createdAt\n                    updatedAt\n                    }\n                }\n        ",variables:{id:s}};fetch(h.API_ENDPOINT,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+e.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){setTimeout((function(){console.log(e)}),1e3)})).catch((function(e){console.log(e)}))}else a((function(e){return!1}))}()},positive:!0})]})]})]})},t._id)}));return Object(g.jsx)(I.a,{size:"large",animated:!0,children:d})},D=function(e){return Object(g.jsxs)(A.a,{onClose:e.onClose,onOpen:e.onOpen,open:e.open,trigger:e.trigger,children:[Object(g.jsxs)(A.a.Header,{children:[e.title," "]}),Object(g.jsx)(A.a.Content,{children:e.modalContent}),Object(g.jsx)(A.a.Actions,{children:Object(g.jsx)(p.a,{color:"black",onClick:e.onClose,children:" Close"})})]})},L=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).closeTheModal=function(){i.setState({open:!1})},i.openTheModal=function(){console.log("closing the modal"),i.setState({open:!0})},i.modalHandleSubmit=function(){console.log("modal handle submit");var e=i.titleElRef.current.value,t=+i.priceElRef.current.value,n=i.dateElRef.current.value,o=i.descriptionElRef.current.value;if(!(0===e.trim().length||t<=0||0===n.trim().length||0===o.trim().length)){var a={title:e,price:t,date:n,description:o};console.log("Event: ",a);var c={query:"\n                mutation CreateEvent($title: String!, $description: String!, $price: Float!, $date: String!){\n                    createEvent(eventInput: {title: $title, description: $description, price: $price, date: $date}) {\n                    _id\n                    title\n                    description\n                    date\n                    price\n                    creator {\n                        _id\n                        email\n                    }\n                    }\n                }\n                ",variables:{title:e,description:o,price:t,date:n}},r=i.context.token;fetch(h.API_ENDPOINT,{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json",Authorization:"Bearer "+r}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){i.setState((function(t){var n=Object(v.a)(t.events);return n.push({_id:e.data.createEvent._id,title:e.data.createEvent.title,description:e.data.createEvent.description,date:e.data.createEvent.date,price:e.data.createEvent.price,creator:{_id:i.context.userId}}),{events:n}}))})).catch((function(e){console.log(e)}))}},i.fetchEvents=function(){i.setState({isLoading:!0});fetch(h.API_ENDPOINT,{method:"POST",body:JSON.stringify({query:"\n                query {\n                    events{\n                    _id\n                    title\n                    description\n                    date\n                    price\n                    creator {\n                        _id\n                        email\n                    }\n                    }\n                }\n        "}),headers:{"Content-Type":"application/json"}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){var t=e.data.events;setTimeout((function(){i.setState({events:t,isLoading:!1})}),600)})).catch((function(e){console.log(e),i.setState({isLoading:!1})}))},i.formContent=function(){return console.log("form content"),Object(g.jsxs)(O.a,{onSubmit:i.modalHandleSubmit,children:[Object(g.jsxs)(O.a.Field,{children:[Object(g.jsx)("label",{className:"ui header blue",children:"Title"}),Object(g.jsx)("input",{ref:i.titleElRef,type:"text",placeholder:"Enter events title"})]}),Object(g.jsxs)(O.a.Group,{widths:"equal",children:[Object(g.jsxs)(O.a.Field,{children:[Object(g.jsx)("label",{className:"ui header blue",children:"Price"}),Object(g.jsx)("input",{ref:i.priceElRef,type:"number",placeholder:"Entry events price"})]}),Object(g.jsxs)(O.a.Field,{children:[Object(g.jsx)("label",{className:"ui header blue",children:"Date"}),Object(g.jsx)("input",{ref:i.dateElRef,type:"datetime-local",placeholder:"enter events date"})]})]}),Object(g.jsxs)(O.a.Field,{children:[Object(g.jsx)("label",{className:"ui header blue",children:"Description"}),Object(g.jsx)("textarea",{rows:2,ref:i.descriptionElRef,type:"text",placeholder:"Enter events title"})]}),Object(g.jsx)(p.a,{className:"ui blue button",type:"submit",children:"Submit"})]})},i.state={open:!1,events:[],isLoading:!1},i.titleElRef=o.a.createRef(),i.priceElRef=o.a.createRef(),i.dateElRef=o.a.createRef(),i.descriptionElRef=o.a.createRef(),i}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"render",value:function(){return console.log("Token from context: ",this.context.token),Object(g.jsx)(o.a.Fragment,{children:Object(g.jsxs)(b.a,{children:[Object(g.jsx)("br",{}),Object(g.jsx)("br",{}),Object(g.jsx)("br",{}),this.context.token&&Object(g.jsxs)(k.a,{children:[Object(g.jsx)("br",{}),Object(g.jsxs)(E.a,{textAlign:"center",children:[Object(g.jsx)("h2",{children:"Share your own events"}),Object(g.jsx)(D,{onSubmit:this.modalHandleSubmit,title:"Add event",open:this.state.open,onOpen:this.openTheModal,onClose:this.closeTheModal,trigger:Object(g.jsx)(p.a,{color:"teal",children:"Create Event"}),modalContent:this.formContent()})]}),Object(g.jsx)("br",{})]}),this.state.isLoading?Object(g.jsx)(y.a,{active:!0,children:Object(g.jsx)(S.a,{size:"massive",children:"Loading"})}):Object(g.jsx)(P,{authUserId:this.context.userId,events:this.state.events,context:this.context})]})})}}]),n}(i.Component);L.contextType=x;var N=L,_=n(358),F=function(e){return Object(g.jsx)(o.a.Fragment,{children:Object(g.jsx)(I.a,{animated:!0,children:e.bookings.map((function(t){return Object(g.jsxs)(I.a.Item,{children:[Object(g.jsxs)(w.a,{columns:2,children:[Object(g.jsx)(w.a.Column,{children:Object(g.jsxs)(E.a,{as:"h3",color:"teal",children:[t.event.title," -",new Date(t.createdAt).toLocaleDateString()]})}),Object(g.jsx)(w.a.Column,{textAlign:"right",children:Object(g.jsx)(p.a,{color:"red",onClick:e.onDelete.bind(undefined,t._id),children:"Cancel"})})]}),Object(g.jsx)(T.a,{})]},t._id)}))})})},R=n(200),$={Cheap:{min:0,max:100},Normal:{min:100,max:200},Expensive:{min:200,max:1e7}},q=function(e){console.log("Bookings info: ",e);var t={labels:[],datasets:[]},n=[],i=function(i){var o=e.bookings.reduce((function(e,t){return t.event.price>$[i].min&&t.event.price<$[i].max?e+1:e}),0);n.push(o),t.labels.push(i),t.datasets.push({fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:n}),(n=Object(v.a)(n))[n.length-1]=0};for(var a in $)i(a);return Object(g.jsx)(o.a.Fragment,{children:Object(g.jsx)(R.a,{data:t,width:100,height:50,options:{maintainAspectRatio:!0}})})},B=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).isActive=!0,i.fetchBookings=function(){console.log("Fetch bookings"),i.setState({isLoading:!0});fetch(h.API_ENDPOINT,{method:"POST",body:JSON.stringify({query:"\n                query {\n                    bookings{\n                    _id\n                    createdAt\n                    event{\n                        _id\n                        title\n                        date\n                        price\n                    }\n                    }\n                }\n        "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+i.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(e){var t=e.data.bookings;i.isActive&&setTimeout((function(){i.setState({bookings:t,isLoading:!1})}),600)})).catch((function(e){console.log(e),i.isActive&&i.setState({isLoading:!1})}))},i.deleteBookingHandler=function(e){i.setState({isLoading:!0});var t={query:"\n                    mutation CancelBooking($id: ID!) {\n                        cancelBooking(bookingId: $id){\n                            _id\n                            title\n                        }\n                    }\n            ",variables:{id:e}};fetch(h.API_ENDPOINT,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer "+i.context.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()})).then((function(t){console.log("Response from cancel booking"),setTimeout((function(){i.setState((function(t){return{bookings:t.bookings.filter((function(t){return t._id!==e})),isLoading:!1}}))}),600)})).catch((function(e){console.log(e),i.isActive&&i.setState({isLoading:!1})}))},i.state={isLoading:!1,bookings:[]},i}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){var e=this,t=Object(g.jsxs)(y.a,{active:!0,children:[" ",Object(g.jsx)(S.a,{size:"massive",children:"Loading"})]});if(!this.state.isLoading){var n=[{menuItem:"List",render:function(){return Object(g.jsx)(_.a.Pane,{children:Object(g.jsx)(F,{bookings:e.state.bookings,onDelete:e.deleteBookingHandler})})}},{menuItem:"Charts",render:function(){return Object(g.jsx)(_.a.Pane,{children:Object(g.jsx)(q,{bookings:e.state.bookings})})}}];t=Object(g.jsx)(o.a.Fragment,{children:Object(g.jsx)(b.a,{children:Object(g.jsx)(k.a,{color:"teal",children:Object(g.jsx)(_.a,{panes:n})})})})}return Object(g.jsx)(o.a.Fragment,{children:t})}}]),n}(i.Component);B.contextType=x;var H=B,M=n(199),J=function(){return Object(g.jsx)(x.Consumer,{children:function(e){return Object(g.jsx)(M.a,{stackable:!0,children:Object(g.jsxs)(b.a,{children:[Object(g.jsx)(u.b,{to:"/",children:Object(g.jsx)(M.a.Item,{style:{color:"teal"},name:"event_management",children:"Event Management"})}),Object(g.jsxs)(M.a.Menu,{position:"right",children:[!e.token&&Object(g.jsx)(u.b,{to:"/auth",children:Object(g.jsx)(M.a.Item,{name:"auth",children:"Auth"})}),Object(g.jsx)(u.b,{to:"/events",children:Object(g.jsx)(M.a.Item,{name:"events",children:"Events"})}),e.token&&Object(g.jsxs)(o.a.Fragment,{children:[Object(g.jsx)(u.b,{to:"/bookings",children:Object(g.jsx)(M.a.Item,{name:"bookings",children:"Bookings"})}),Object(g.jsx)(M.a.Item,{name:"logout",children:Object(g.jsx)(p.a,{onClick:e.logout,color:"red",children:"Logout"})})]})]})]})})}})},z=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(r.a)(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).state={token:null,userId:null},e.login=function(t,n,i){e.setState({token:t,userId:n})},e.logout=function(){e.setState({token:null,userId:null})},e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){document.title="MERN Stack Events App"}},{key:"render",value:function(){return Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(u.a,{children:Object(g.jsx)(o.a.Fragment,{children:Object(g.jsxs)(x.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout},children:[Object(g.jsx)(J,{}),Object(g.jsxs)(j.d,{children:[this.state.token&&Object(g.jsx)(j.a,{from:"/",to:"/events",exact:!0}),this.state.token&&Object(g.jsx)(j.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&Object(g.jsx)(j.b,{path:"/auth",component:m}),Object(g.jsx)(j.b,{path:"/events",component:N}),this.state.token&&Object(g.jsx)(j.b,{path:"/bookings",component:H}),!this.state.token&&Object(g.jsx)(j.a,{to:"/auth",exact:!0})]})]})})})})}}]),n}(i.Component),U=z,G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,359)).then((function(t){var n=t.getCLS,i=t.getFID,o=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),i(e),o(e),a(e),c(e)}))};c.a.render(Object(g.jsx)(o.a.StrictMode,{children:Object(g.jsx)(U,{})}),document.getElementById("root")),G()}},[[336,1,2]]]);
//# sourceMappingURL=main.2bcad7fa.chunk.js.map